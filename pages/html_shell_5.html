<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.41.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.41.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<style>
    #menu {
        position: absolute;
        background: #fff;
        padding: 10px;
        font-family: 'Open Sans', sans-serif;
    }
	
    #menu2 {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }

    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }
</style>

<div id='map'></div>
<div id='menu'>
<center><b>Background Layer</b></center>
    <input id='basic' type='radio' name='rtoggle' value='basic' checked='checked'>
    <label for='basic'>Mapbox Light</label><br>
    <input id='satellite' type='radio' name='rtoggle' value='satellite'>
    <label for='satellite'>Satellite Image</label>
	<br><br><b>Data Layer Toggle</b>
</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoicGVkdzE3MCIsImEiOiJjajZkM3Z6ZWsxd20wMnhsN3A0NGYyYWZoIn0.W2KJ8AnKDdLz1k75YsIOrg';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/pedw170/cj8uuwity418q2roa45kmt129',
    center: [-98.333, 31.00],
    zoom: 5.5
});

map.on('load', function() {
    //Add a geojson point source.  
    //Heatmap layers also work with a vector tile source.
    map.addSource('fires2011', {
        type: "geojson",
        data: "https://pedw170.github.io/pages/tx_fires_2011.geojson"
    });

var layerList = document.getElementById('menu');
var inputs = layerList.getElementsByTagName('input');

function switchLayer(layer) {
    var layerId = layer.target.id;
    map.setStyle('mapbox://styles/mapbox/' + layerId + '-v9');
	map.on('style.load', function(){
		map.addSource('fires2011', {
        type: "geojson",
        data: "https://pedw170.github.io/pages/tx_fires_2011.geojson"
    });
	
	    map.addLayer({
        "id": "Heatmap",
        "type": "heatmap",
        "source": "fires2011",
        "maxzoom": 9,
        "paint": {
            //Increase the heatmap weight based on frequency and property magnitude
            "heatmap-weight": {
                "property": "FIRE_SIZE",
                "type": "exponential",
                "stops": [
                    [0, 0],
					[0.25, 0.05],
					[10, 0.125],
					[250, 0.25],
					[1000, 0.571],
					[5000, 0.714],
                    [314444, 1]
                ]
            },
            //Increase the heatmap color weight weight by zoom level
            //heatmap-ntensity is a multiplier on top of heatmap-weight
            "heatmap-intensity": {
                "stops": [
                    [0, 1],
                    [9, 3]
                ]
            },
            //Color ramp for heatmap.  Domain is 0 (low) to 1 (high).
            //Begin color ramp at 0-stop with a 0-transparancy color
            //to create a blur-like effect.
            "heatmap-color": {
                "stops": [
                    [0, "rgba(69,117,180,0)"],
                    [0.2, "rgb(145,191,219)"],
                    [0.4, "rgb(224,243,248)"],
                    [0.6, "rgb(254,224,144)"],
                    [0.8, "rgb(252,141,89)"],
                    [1, "rgb(215,48,39)"]
                ]
            },
            //Adjust the heatmap radius by zoom level
            "heatmap-radius": {
                "stops": [
                    [0, 2],
					[5, 10],
                    [9, 20]
                ]
            },
            //Transition from heatmap to circle layer by zoom level
            "heatmap-opacity": {
                "default": 1,
                "stops": [
                    [9, 1],
                    [10, 0]
                ]
            },
        }
    });

    map.addLayer({
        "id": "Points",
        "type": "circle",
        "source": "fires2011",
        "minzoom": 7,
        "paint": {
            //Size circle raidus by fire severity/size
            "circle-radius": {
                "property": "FIRE_SIZE",
                "type": "exponential",
                "stops": [
                    [{ zoom: 7, value: 0 }, 3],
					[{ zoom: 7, value: 0.25 }, 5],
                    [{ zoom: 7, value: 9 }, 8],
					[{ zoom: 7, value: 100 }, 12],
					[{ zoom: 7, value: 300 }, 16],
					[{ zoom: 7, value: 1000 }, 24],
					[{ zoom: 7, value: 5000 }, 32],
					[{ zoom: 7, value: 314444 }, 40]
                ]
            },
            //Color circle by fire severity/size
            "circle-color": {
                "property": "FIRE_SIZE",
                "type": "exponential",
                "stops": [
                    [0, "rgb(241,238,246)"],
                    [0.25, "rgb(212,185,218)"],
                    [10, "rgb(201,148,199)"],
                    [100, "rgb(223,101,176)"],
                    [1000, "rgb(221,28,119)"],
                    [5000, "rgb(152,0,67)"],
					[314444, "rgb(152,0,67)"]
                ]
            },
            "circle-stroke-color": "white",
            "circle-stroke-width": 1,
        }
    });})
}

for (var i = 0; i < inputs.length; i++) {
    inputs[i].onclick = switchLayer;
}
    map.addLayer({
        "id": "Heatmap",
        "type": "heatmap",
        "source": "fires2011",
        "maxzoom": 9,
        "paint": {
            //Increase the heatmap weight based on frequency and property magnitude
            "heatmap-weight": {
                "property": "FIRE_SIZE",
                "type": "exponential",
                "stops": [
                    [0, 0],
					[0.25, 0.05],
					[10, 0.125],
					[250, 0.25],
					[1000, 0.571],
					[5000, 0.714],
                    [314444, 1]
                ]
            },
            //Increase the heatmap color weight weight by zoom level
            //heatmap-ntensity is a multiplier on top of heatmap-weight
            "heatmap-intensity": {
                "stops": [
                    [0, 1],
                    [9, 3]
                ]
            },
            //Color ramp for heatmap.  Domain is 0 (low) to 1 (high).
            //Begin color ramp at 0-stop with a 0-transparancy color
            //to create a blur-like effect.
            "heatmap-color": {
                "stops": [
                    [0, "rgba(69,117,180,0)"],
                    [0.2, "rgb(145,191,219)"],
                    [0.4, "rgb(224,243,248)"],
                    [0.6, "rgb(254,224,144)"],
                    [0.8, "rgb(252,141,89)"],
                    [1, "rgb(215,48,39)"]
                ]
            },
            //Adjust the heatmap radius by zoom level
            "heatmap-radius": {
                "stops": [
                    [0, 2],
					[5, 10],
                    [9, 20]
                ]
            },
            //Transition from heatmap to circle layer by zoom level
            "heatmap-opacity": {
                "default": 1,
                "stops": [
                    [9, 1],
                    [10, 0]
                ]
            },
        }
    });

    map.addLayer({
        "id": "Points",
        "type": "circle",
        "source": "fires2011",
        "minzoom": 7,
        "paint": {
            //Size circle raidus by fire severity/size
            "circle-radius": {
                "property": "FIRE_SIZE",
                "type": "exponential",
                "stops": [
                    [{ zoom: 7, value: 0 }, 3],
					[{ zoom: 7, value: 0.25 }, 5],
                    [{ zoom: 7, value: 9 }, 8],
					[{ zoom: 7, value: 100 }, 12],
					[{ zoom: 7, value: 300 }, 16],
					[{ zoom: 7, value: 1000 }, 24],
					[{ zoom: 7, value: 5000 }, 32],
					[{ zoom: 7, value: 314444 }, 40]
                ]
            },
            //Color circle by fire severity/size
            "circle-color": {
                "property": "FIRE_SIZE",
                "type": "exponential",
                "stops": [
                    [0, "rgb(241,238,246)"],
                    [0.25, "rgb(212,185,218)"],
                    [10, "rgb(201,148,199)"],
                    [100, "rgb(223,101,176)"],
                    [1000, "rgb(221,28,119)"],
                    [5000, "rgb(152,0,67)"],
					[314444, "rgb(152,0,67)"]
                ]
            },
            "circle-stroke-color": "white",
            "circle-stroke-width": 1,
        }
    });
});

var toggleableLayerIds = [ 'Heatmap', 'Points' ];

for (var i = 0; i < toggleableLayerIds.length; i++) {
    var id = toggleableLayerIds[i];

    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = id;

    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };

    var layers = document.getElementById('menu');
    layers.appendChild(link);
}


// When a click event occurs on a feature in the places layer, open a popup at the
// location of the feature, with description HTML from its properties.
map.on('click', 'Points', function (e) {
new mapboxgl.Popup()
.setLngLat(e.features[0].geometry.coordinates)
.setHTML('<center><b>Fire Details</b></center>'+'<b>Size Category: </b>'+e.features[0].properties.FIRE_SIZE_)
.addTo(map);
});

</script>
</body>
</html>